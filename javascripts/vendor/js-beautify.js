/*jslint onevar: false, plusplus: false */
/*jshint curly:true, eqeqeq:true, laxbreak:true, noempty:false */
/*

 JS Beautifier
---------------


  Written by Einar Lielmanis, <einar@jsbeautifier.org>
      http://jsbeautifier.org/

  Originally converted to javascript by Vital, <vital76@gmail.com>
  "End braces on own line" added by Chris J. Shull, <chrisjshull@gmail.com>

  You are free to use this in any way you want, in case you find this useful or working for you.

  Usage:
    js_beautify(js_source_text);
    js_beautify(js_source_text, options);

  The options are:
    indent_size (default 4)          - indentation size,
    indent_char (default space)      - character to indent with,
    preserve_newlines (default true) - whether existing line breaks should be preserved,
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk,

    jslint_happy (default false) - if true, then jslint-stricter mode is enforced.

            jslint_happy   !jslint_happy
            ---------------------------------
             function ()      function()

    brace_style (default "collapse") - "collapse" | "expand" | "end-expand" | "expand-strict"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line.

            expand-strict: put brace on own line even in such cases:

                var a =
                {
                    a: 5,
                    b: 6
                }
            This mode may break your scripts - e.g "return { a: 1 }" will be broken into two lines, so beware.

    space_before_conditional (default true) - should the space before conditional statement be added, "if(true)" vs "if (true)",

    unescape_strings (default false) - should printable characters in strings encoded in \xNN notation be unescaped, "example" vs "\x65\x78\x61\x6d\x70\x6c\x65"

    e.g

    js_beautify(js_source_text, {
      'indent_size': 1,
      'indent_char': '\t'
    });


*/
function js_beautify(e,t){function B(e){e=typeof e=="undefined"?!1:e;while(r.length&&(r[r.length-1]===" "||r[r.length-1]===c||r[r.length-1]===T||e&&(r[r.length-1]==="\n"||r[r.length-1]==="\r")))r.pop()}function j(e){return e.replace(/^\s\s*|\s\s*$/,"")}function F(e){e=e.replace(/\x0d/g,"");var t=[],n=e.indexOf("\n");while(n!==-1)t.push(e.substring(0,n)),e=e.substring(n+1),n=e.indexOf("\n");return e.length&&t.push(e),t}function I(){var e=_;_=!1,q(),_=e}function q(e,t){f.eat_next_space=!1;if(_&&V(f.mode))return;e=typeof e=="undefined"?!0:e,t=typeof t=="undefined"?!0:t,t&&(f.if_line=!1,f.chain_extra_indentation=0),B();if(!r.length)return;if(r[r.length-1]!=="\n"||!e)S=!0,r.push("\n");T&&r.push(T);for(var n=0;n<f.indentation_level+f.chain_extra_indentation;n+=1)r.push(c);f.var_line&&f.var_line_reindented&&r.push(c)}function R(){var e=" ";f.eat_next_space?f.eat_next_space=!1:s==="TK_COMMENT"?q():(r.length&&(e=r[r.length-1]),e!==" "&&e!=="\n"&&e!==c&&r.push(" "))}function U(){S=!1,f.eat_next_space=!1,r.push(i)}function z(){f.indentation_level+=1}function W(){r.length&&r[r.length-1]===c&&r.pop()}function X(e){f&&l.push(f),f={previous_mode:f?f.mode:"BLOCK",mode:e,var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,if_line:!1,chain_extra_indentation:0,in_case_statement:!1,in_case:!1,case_body:!1,eat_next_space:!1,indentation_level:f?f.indentation_level+(f.var_line&&f.var_line_reindented?1:0):0,ternary_depth:0}}function V(e){return e==="[EXPRESSION]"||e==="[INDENTED-EXPRESSION]"}function $(e){return G(e,["[EXPRESSION]","(EXPRESSION)","(FOR-EXPRESSION)","(COND-EXPRESSION)"])}function J(){w=f.mode==="DO_BLOCK";if(l.length>0){var e=f.mode;f=l.pop(),f.previous_mode=e}}function K(e,t){for(var n=0;n<e.length;n++){var r=j(e[n]);if(r.charAt(0)!==t)return!1}return!0}function Q(e){return G(e,["case","return","do","if","throw","else"])}function G(e,t){for(var n=0;n<t.length;n+=1)if(t[n]===e)return!0;return!1}function Y(e){var t=!1,n="",r=0,i="",s=0,o;while(t||r<e.length){o=e.charAt(r),r++;if(t){t=!1;if(o==="x")i=e.substr(r,2),r+=2;else{if(o!=="u"){n+="\\"+o;continue}i=e.substr(r,4),r+=4}if(!i.match(/^[0123456789abcdefABCDEF]+$/))return e;s=parseInt(i,16);if(s>=0&&s<32){o==="x"?n+="\\x"+i:n+="\\u"+i;continue}if(s==34||s===39||s==92)n+="\\"+String.fromCharCode(s);else{if(o==="x"&&s>126&&s<=255)return e;n+=String.fromCharCode(s)}}else o=="\\"?t=!0:n+=o}return n}function Z(e){var t=v,r=n.charAt(t);while(G(r,h)&&r!==e){t++;if(t>=H)return 0;r=n.charAt(t)}return r}function et(){var e;x=0;if(v>=H)return["","TK_EOF"];E=!1;var t=n.charAt(v);v+=1;var i=_&&V(f.mode);if(i){var u=0;while(G(t,h)){t==="\n"?(B(),r.push("\n"),S=!0,u=0):S&&(t===c?r.push(c):t!=="\r"&&r.push(" "));if(v>=H)return["","TK_EOF"];t=n.charAt(v),v+=1}}else{while(G(t,h)){t==="\n"&&(x+=O?x<=O?1:0:1);if(v>=H)return["","TK_EOF"];t=n.charAt(v),v+=1}if(L&&x>1)for(e=0;e<x;e+=1)q(e===0),S=!0;E=x>0}if(G(t,p)){if(v<H)while(G(n.charAt(v),p)){t+=n.charAt(v),v+=1;if(v===H)break}if(v===H||!t.match(/^[0-9]+[Ee]$/)||n.charAt(v)!=="-"&&n.charAt(v)!=="+")return t==="in"?[t,"TK_OPERATOR"]:(E&&s!=="TK_OPERATOR"&&s!=="TK_EQUALS"&&!f.if_line&&(L||o!=="var")&&q(),[t,"TK_WORD"]);var a=n.charAt(v);v+=1;var l=et();return t+=a+l[0],[t,"TK_WORD"]}if(t==="("||t==="[")return[t,"TK_START_EXPR"];if(t===")"||t==="]")return[t,"TK_END_EXPR"];if(t==="{")return[t,"TK_START_BLOCK"];if(t==="}")return[t,"TK_END_BLOCK"];if(t===";")return[t,"TK_SEMICOLON"];if(t==="/"){var m="",y=!0;if(n.charAt(v)==="*"){v+=1;if(v<H)while(v<H&&(n.charAt(v)!=="*"||!n.charAt(v+1)||n.charAt(v+1)!=="/")){t=n.charAt(v),m+=t;if(t==="\n"||t==="\r")y=!1;v+=1;if(v>=H)break}return v+=2,y&&x===0?["/*"+m+"*/","TK_INLINE_COMMENT"]:["/*"+m+"*/","TK_BLOCK_COMMENT"]}if(n.charAt(v)==="/"){m=t;while(n.charAt(v)!=="\r"&&n.charAt(v)!=="\n"){m+=n.charAt(v),v+=1;if(v>=H)break}return E&&q(),[m,"TK_COMMENT"]}}if(t==="'"||t==='"'||t==="/"&&(s==="TK_WORD"&&Q(o)||o===")"&&G(f.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])||s==="TK_COMMA"||s==="TK_COMMENT"||s==="TK_START_EXPR"||s==="TK_START_BLOCK"||s==="TK_END_BLOCK"||s==="TK_OPERATOR"||s==="TK_EQUALS"||s==="TK_EOF"||s==="TK_SEMICOLON")){var b=t,w=!1,T=!1,N=t;if(v<H)if(b==="/"){var C=!1;while(w||C||n.charAt(v)!==b){N+=n.charAt(v),w?w=!1:(w=n.charAt(v)==="\\",n.charAt(v)==="["?C=!0:n.charAt(v)==="]"&&(C=!1)),v+=1;if(v>=H)return[N,"TK_STRING"]}}else while(w||n.charAt(v)!==b){N+=n.charAt(v);if(w){if(n.charAt(v)==="x"||n.charAt(v)==="u")T=!0;w=!1}else w=n.charAt(v)==="\\";v+=1;if(v>=H)return[N,"TK_STRING"]}v+=1,N+=b,T&&P&&(N=Y(N));if(b==="/")while(v<H&&G(n.charAt(v),p))N+=n.charAt(v),v+=1;return[N,"TK_STRING"]}if(t==="#"){if(r.length===0&&n.charAt(v)==="!"){N=t;while(v<H&&t!=="\n")t=n.charAt(v),N+=t,v+=1;return r.push(j(N)+"\n"),q(),et()}var k="#";if(v<H&&G(n.charAt(v),g)){do t=n.charAt(v),k+=t,v+=1;while(v<H&&t!=="#"&&t!=="=");return t!=="#"&&(n.charAt(v)==="["&&n.charAt(v+1)==="]"?(k+="[]",v+=2):n.charAt(v)==="{"&&n.charAt(v+1)==="}"&&(k+="{}",v+=2)),[k,"TK_WORD"]}}if(t==="<"&&n.substring(v-1,v+3)==="<!--"){v+=3,t="<!--";while(n.charAt(v)!=="\n"&&v<H)t+=n.charAt(v),v++;return f.in_html_comment=!0,[t,"TK_COMMENT"]}if(t==="-"&&f.in_html_comment&&n.substring(v-1,v+2)==="-->")return f.in_html_comment=!1,v+=2,E&&q(),["-->","TK_COMMENT"];if(t===".")return[t,"TK_DOT"];if(G(t,d)){while(v<H&&G(t+n.charAt(v),d)){t+=n.charAt(v),v+=1;if(v>=H)break}return t===","?[t,"TK_COMMA"]:t==="="?[t,"TK_EQUALS"]:[t,"TK_OPERATOR"]}return[t,"TK_UNKNOWN"]}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T="";t=t?t:{};var N;t.space_after_anon_function!==undefined&&t.jslint_happy===undefined&&(t.jslint_happy=t.space_after_anon_function),t.braces_on_own_line!==undefined&&(N=t.braces_on_own_line?"expand":"collapse"),N=t.brace_style?t.brace_style:N?N:"collapse";var C=t.indent_size?t.indent_size:4,k=t.indent_char?t.indent_char:" ",L=typeof t.preserve_newlines=="undefined"?!0:t.preserve_newlines,A=typeof t.break_chained_methods=="undefined"?!1:t.break_chained_methods,O=typeof t.max_preserve_newlines=="undefined"?!1:t.max_preserve_newlines,M=t.jslint_happy==="undefined"?!1:t.jslint_happy,_=typeof t.keep_array_indentation=="undefined"?!1:t.keep_array_indentation,D=typeof t.space_before_conditional=="undefined"?!0:t.space_before_conditional,P=typeof t.unescape_strings=="undefined"?!1:t.unescape_strings;S=!1;var H=e.length;c="";while(C>0)c+=k,C-=1;while(e&&(e.charAt(0)===" "||e.charAt(0)==="	"))T+=e.charAt(0),e=e.substring(1);n=e,a="",s="TK_START_EXPR",o="",u="",r=[],w=!1,h="\n\r	 ".split(""),p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),g="0123456789".split(""),d="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::",d+=" <%= <% %> <?= <? ?>",d=d.split(" "),m="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),l=[],X("BLOCK"),v=0;for(;;){var tt=et();i=tt[0],b=tt[1];if(b==="TK_EOF")break;switch(b){case"TK_START_EXPR":if(i==="["){if(s==="TK_WORD"||o===")"){G(o,m)&&R(),X("(EXPRESSION)"),U();break}f.mode==="[EXPRESSION]"||f.mode==="[INDENTED-EXPRESSION]"?u==="]"&&o===","?(f.mode==="[EXPRESSION]"&&(f.mode="[INDENTED-EXPRESSION]",_||z()),X("[EXPRESSION]"),_||q()):o==="["?(f.mode==="[EXPRESSION]"&&(f.mode="[INDENTED-EXPRESSION]",_||z()),X("[EXPRESSION]"),_||q()):X("[EXPRESSION]"):X("[EXPRESSION]")}else a==="for"?X("(FOR-EXPRESSION)"):G(a,["if","while"])?X("(COND-EXPRESSION)"):X("(EXPRESSION)");o===";"||s==="TK_START_BLOCK"?q():s==="TK_END_EXPR"||s==="TK_START_EXPR"||s==="TK_END_BLOCK"||o==="."?E&&q():s!=="TK_WORD"&&s!=="TK_OPERATOR"?R():a==="function"||a==="typeof"?M&&R():(G(o,m)||o==="catch")&&D&&R(),U();break;case"TK_DOT":Q(o)?R():o===")"&&(A||E)&&(f.chain_extra_indentation=1,q(!0,!1)),U();break;case"TK_END_EXPR":if(i==="]")if(_){if(o==="}"){W(),U(),J();break}}else if(f.mode==="[INDENTED-EXPRESSION]"&&o==="]"){J(),q(),U();break}J(),U();break;case"TK_START_BLOCK":a==="do"?X("DO_BLOCK"):X("BLOCK");if(N==="expand"||N==="expand-strict"){var nt=!1;N==="expand-strict"?(nt=Z()==="}",nt||q(!0)):s!=="TK_OPERATOR"&&(o==="="||Q(o)&&o!=="else"?R():q(!0)),U(),nt||z()}else s!=="TK_OPERATOR"&&s!=="TK_START_EXPR"?s==="TK_START_BLOCK"?q():R():V(f.previous_mode)&&o===","&&(u==="}"?R():q()),z(),U();break;case"TK_END_BLOCK":J(),N==="expand"||N==="expand-strict"?(o!=="{"&&q(),U()):(s==="TK_START_BLOCK"?S?W():B():V(f.mode)&&_?(_=!1,q(),_=!0):q(),U());break;case"TK_WORD":if(w){R(),U(),R(),w=!1;break}y="NONE";if(i==="function"){f.var_line&&s!=="TK_EQUALS"&&(f.var_line_reindented=!0);if((S||o===";")&&o!=="{"&&s!=="TK_BLOCK_COMMENT"&&s!=="TK_COMMENT"){x=S?x:0,L||(x=1);for(var rt=0;rt<2-x;rt++)q(!1)}s==="TK_WORD"?o==="get"||o==="set"||o==="new"||o==="return"?R():q():s==="TK_OPERATOR"||o==="="?R():$(f.mode)||q(),U(),a=i;break}if(i==="case"||i==="default"&&f.in_case_statement){q(),f.case_body&&(f.indentation_level--,f.case_body=!1,W()),U(),f.in_case=!0,f.in_case_statement=!0;break}s==="TK_END_BLOCK"?G(i.toLowerCase(),["else","catch","finally"])?N==="expand"||N==="end-expand"||N==="expand-strict"?y="NEWLINE":(y="SPACE",R()):y="NEWLINE":s!=="TK_SEMICOLON"||f.mode!=="BLOCK"&&f.mode!=="DO_BLOCK"?s==="TK_SEMICOLON"&&$(f.mode)?y="SPACE":s==="TK_STRING"?y="NEWLINE":s==="TK_WORD"?(o==="else"&&B(!0),y="SPACE"):s==="TK_START_BLOCK"?y="NEWLINE":s==="TK_END_EXPR"&&(R(),y="NEWLINE"):y="NEWLINE",G(i,m)&&o!==")"&&(o==="else"?y="SPACE":y="NEWLINE"),f.if_line&&s==="TK_END_EXPR"&&(f.if_line=!1),G(i.toLowerCase(),["else","catch","finally"])?s!=="TK_END_BLOCK"||N==="expand"||N==="end-expand"||N==="expand-strict"?q():(B(!0),R()):y==="NEWLINE"?Q(o)?R():s!=="TK_END_EXPR"?(s!=="TK_START_EXPR"||i!=="var")&&o!==":"&&(i==="if"&&a==="else"&&o!=="{"?R():(f.var_line=!1,f.var_line_reindented=!1,q())):G(i,m)&&o!==")"&&(f.var_line=!1,f.var_line_reindented=!1,q()):V(f.mode)&&o===","&&u==="}"?q():y==="SPACE"&&R(),U(),a=i,i==="var"&&(f.var_line=!0,f.var_line_reindented=!1,f.var_line_tainted=!1),i==="if"&&(f.if_line=!0),i==="else"&&(f.if_line=!1);break;case"TK_SEMICOLON":U(),f.var_line=!1,f.var_line_reindented=!1,f.mode==="OBJECT"&&(f.mode="BLOCK");break;case"TK_STRING":s==="TK_END_EXPR"&&G(f.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])?R():s==="TK_WORD"?R():s==="TK_COMMA"||s==="TK_START_EXPR"||s==="TK_EQUALS"||s==="TK_OPERATOR"?L&&E&&f.mode!=="OBJECT"&&(q(),r.push(c)):q(),U();break;case"TK_EQUALS":f.var_line&&(f.var_line_tainted=!0),R(),U(),R();break;case"TK_COMMA":if(f.var_line){if($(f.mode)||s==="TK_END_BLOCK")f.var_line_tainted=!1;if(f.var_line_tainted){U(),f.var_line_reindented=!0,f.var_line_tainted=!1,q();break}f.var_line_tainted=!1,U(),R();break}s==="TK_COMMENT"&&q(),s==="TK_END_BLOCK"&&f.mode!=="(EXPRESSION)"?(U(),f.mode==="OBJECT"&&o==="}"?q():R()):f.mode==="OBJECT"?(U(),q()):(U(),R());break;case"TK_OPERATOR":var it=!0,st=!0;if(Q(o)){R(),U();break}if(i==="*"&&s==="TK_DOT"&&!u.match(/^\d+$/)){U();break}if(i===":"&&f.in_case){f.case_body=!0,z(),U(),q(),f.in_case=!1;break}if(i==="::"){U();break}G(i,["--","++","!"])||G(i,["-","+"])&&(G(s,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||G(o,m)||o==",")?(it=!1,st=!1,o===";"&&$(f.mode)&&(it=!0),s==="TK_WORD"&&G(o,m)&&(it=!0),f.mode==="BLOCK"&&(o==="{"||o===";")&&q()):i===":"?f.ternary_depth===0?(f.mode==="BLOCK"&&(f.mode="OBJECT"),it=!1):f.ternary_depth-=1:i==="?"&&(f.ternary_depth+=1),it&&R(),U(),st&&R();break;case"TK_BLOCK_COMMENT":var ot=F(i),ut;if(K(ot.slice(1),"*")){q(),r.push(ot[0]);for(ut=1;ut<ot.length;ut++)q(),r.push(" "),r.push(j(ot[ut]))}else{ot.length>1?q():s==="TK_END_BLOCK"?q():R();for(ut=0;ut<ot.length;ut++)r.push(ot[ut]),r.push("\n")}Z("\n")!=="\n"&&q();break;case"TK_INLINE_COMMENT":R(),U(),$(f.mode)?R():I();break;case"TK_COMMENT":o===","&&!E&&B(!0),s!=="TK_COMMENT"&&(E?q():R()),U(),q();break;case"TK_UNKNOWN":U()}u=o,s=b,o=i}var at=T+r.join("").replace(/[\r\n ]+$/,"");return at}typeof exports!="undefined"&&(exports.js_beautify=js_beautify);