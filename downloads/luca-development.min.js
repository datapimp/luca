(function(){var codeManager,_base,_base1,_base2;codeManager=Luca.register("Luca.CodeSyncManager"),codeManager["extends"]("Luca.SocketManager"),codeManager.publicConfiguration({host:(_base=Luca.config).codeSyncHost||(_base.codeSyncHost="//localhost:9295/luca"),channel:(_base1=Luca.config).codeSyncChannel||(_base1.codeSyncChannel="/code-sync"),styleSheetMode:(_base2=Luca.config).codeSyncStylesheetMode||(_base2.codeSyncStylesheetMode="single")}),codeManager.classMethods({setup:function(a){return a==null&&(a={}),this.codeSync=new Luca.CodeSyncManager(a),this.codeSync.trigger("ready")}}),codeManager.privateMethods({initialize:function(a){return this.attributes=a!=null?a:{},this.attributes.host==null&&_.extend(this.attributes,{host:this.host||Luca.config.codeSyncHost}),Luca.SocketManager.prototype.initialize.call(this,this.attributes),this.bindToChannel()},start:function(){return this.trigger("ready")},bindToChannel:function(){var a=this;return this.client!=null?this.client.subscribe(this.channel,function(){return a.onChangesNotification.apply(a,arguments)}):this.on("change:client",function(b,c){return a.client.subscribe(a.channel,function(){return a.onChangesNotification.apply(a,arguments)})})},onChangesNotification:function(a,b){var c,d=this;a==null&&(a={});if(_.isEmpty(a))return;c=_(a).values()[0]||{},c.type==="template"&&(this.processTemplate(c),this.rerunSyncPad(c.type)),c.type==="component_definition"&&(this.processComponentDefinitionChange(c),this.processJavascriptChange(c),_.delay(function(){return d.rerunSyncPad(c.type)},25)),c.type==="javascript"&&this.processJavascriptChange(c);if(c.type==="stylesheet"&&(c!=null?c.path:void 0))return this.processStylesheetChange(c)},rerunSyncPad:function(){var a;if(a=this.get("last_syncpad_javascript_payload"))return this.processJavascriptChange(a)},processTemplate:function(change){var fn;return change==null&&(change={}),fn=function(){return eval(change.contents)},fn.apply(window)},processComponentDefinitionChange:function(a){var b;a==null&&(a={});if(_.isEmpty(a))return;this.components||(this.components=Luca.collections.Components.generate());if(a.class_name!=null){b=this.components.findByClassName(a.class_name);if(b&&a.source_file_contents!=null)return b.set({source_file_contents:a.source_file_contents})}},processJavascriptChange:function(a){var b,c,d;a==null&&(a={});if(a!=null?!a.compiled:!void 0)return;return b=$("body script[data-path='"+a.source+"']"),b.length>1&&b.remove(),((d=a.source)!=null?d.match(/syncpad/):void 0)&&(a!=null?a.compiled:void 0)&&!0&&this.set("last_syncpad_javascript_payload",a),c=this.make("script",{"data-path":a.source,type:"text/javascript"},a.compiled),$("body").append(c)},processStylesheetChange:function(a){var b;a==null&&(a={});if(_.isEmpty(a))return;return((b=a.path)!=null?b.match(/syncpad/):void 0)||this.styleSheetMode==="single"?this.syncStylesheet(a):this.replaceStylesheetAndEverythingAfter(a.path)},replaceStylesheetAndEverythingAfter:function(a){var b,c,d,e,f,g;g=a.replace("./app/assets/stylesheets",Luca.config.assetsUrlPrefix),g=g.replace(".scss",""),d=$("link[href*='"+g+"']"),e=d.parent();if(d.length>0)return f=d.clone(),c=d.nextAll("link"),b=c.clone(),$(d,c).remove(),e.append(f),e.append(b);return},syncStylesheet:function(a){var b,c;b=$("head style[data-file='"+a.path+"']"),b.length>0&&b.remove();if(a.compiled!=null||a.contents!=null)return c=this.make("style",{"data-file":a.path,type:"text/css"},a.compiled||a.contents),$("head").append(c)}}),codeManager.defines({make:Luca.View.prototype.make})}).call(this),function(){var a;a=Luca.register("Luca.models.Component"),a["extends"]("Luca.Model"),a.configuration({defaults:{class_name:void 0,superClass:void 0,asset_id:void 0,source_file_contents:"",defined_in_file:""}}),a.defines({idAttribute:"class_name",documentation:function(){var a;return a=_(this.toJSON()).pick("header_documentation","class_name","defined_in_file"),_.extend(a,this.metaData(),{componentGroup:this.componentGroup(),componentType:this.componentType(),componentTypeAlias:this.componentTypeAlias(),details:{publicMethods:this.documentationFor("publicMethods"),privateMethods:this.documentationFor("privateMethods"),privateProperties:this.documentationFor("privateProperties"),publicProperties:this.documentationFor("publicProperties")}})},documentationFor:function(a){var b,c,d,e;return a==null&&(a="publicMethods"),b=_.extend({},this.get("defines_methods"),this.get("defines_properties")),d={},(c=(e=this.metaData())!=null?typeof e[a]=="function"?e[a]():void 0:void 0)&&_(c).reduce(function(a,c){return a[c]=b[c],a},d),d},url:function(){return"/project/components/"+Luca.namespace+"/"+this.classNameId()},metaData:function(){return Luca(this.get("class_name")).prototype.componentMetaData()},classNameId:function(){return this.get("class_name").replace(/\./g,"__")},componentGroup:function(){var a;return a=this.get("class_name").split("."),a.slice(0,2).join(".")},componentType:function(){var a,b,c,d;d="view",c=this.get("class_name").split(".");switch(b=c[1]){case"collections":"collection";break;case"models":"model";break;case"views":"view"}if(b!=null)return;if(a=Luca.util.resolve(this.get("class_name"))){if(Luca.isViewPrototype(a.prototype))return"view";if(Luca.isCollectionPrototype(a.prototype))return"collection";if(Luca.isModelProtoype(a.prototype))return"model"}return"view"},componentTypeAlias:function(){var a,b;return b=this.get("class_name").split("."),a=b.pop(),_.str.underscored(a)}})}.call(this),function(){var a;a=Luca.register("Luca.collections.Components"),a["extends"]("Luca.Collection"),a.configuration({model:Luca.models.Component,namespace:"components"}),a.classMethods({generate:function(){return this.collection=new Luca.collections.Components,this.collection.fetch(),this.collection}}),a.defines({findByClassName:function(a){return this.detect(function(b){return b.get("class_name")===a})},filterByNamespace:function(a){return this.query({class_name:{$like:a}})},classNames:function(){return this.pluck("class_name")},groupsInsideOf:function(a){var b,c,d,e,f,g,h;b=this.filterByNamespace(a),d={};for(e=0,f=b.length;e<f;e++)c=b[e],d[c.componentGroup()]==null&&((g=c.get("class_name"))!=null?(h=g.split("."))!=null?h.length:void 0:void 0)>2&&(d[c.componentGroup()]=c.componentGroup().split(".")[1]);return _.values(d)},namespaces:function(){var a;return a=_(this.classNames()).map(function(a){return a.split(".")[0]}),_(a).uniq()},fetch:function(a){return a==null&&(a={}),this.populateFromRegistry(a)},comparator:function(a){return a.get("class_name")},populateFromRegistry:function(a){var b,c,d;return a==null&&(a={}),d=function(){var a,c,d,e;d=Luca.registry.classes(!0),e=[];for(a=0,c=d.length;a<c;a++)b=d[a],e.push({class_name:b,name:b});return e}(),a.namespace&&(d=function(){var b,e,f;f=[];for(b=0,e=d.length;b<e;b++)c=d[b],c.name.match(a.namespace)&&f.push(c);return f}()),this.reset(d,a={})}})}.call(this),function(){}.call(this);